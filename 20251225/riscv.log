BUG: Bad page state in process syz.4.602  pfn:aa7b9
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff6000002a7b9dc0 pfn:0xaa7b9
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff6000002a7b9dc0 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881481271100, free_ts 2879444654900
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 vfree+0x20e/0x390 mm/vmalloc.c:3440
 delayed_vfree_work+0x52/0x80 mm/vmalloc.c:3359
 process_one_work+0x7ac/0x1474 kernel/workqueue.c:3263
 process_scheduled_works kernel/workqueue.c:3346 [inline]
 worker_thread+0x984/0xe90 kernel/workqueue.c:3427
 kthread+0x65a/0x79c kernel/kthread.c:463
 ret_from_fork_kernel+0x38/0xa64 arch/riscv/kernel/process.c:228
 ret_from_fork_kernel_asm+0x16/0x1c arch/riscv/kernel/entry.S:147
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Not tainted 6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:9df7b
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff6000001df7b000 pfn:0x9df7b
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff6000001df7b000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881481095400, free_ts 2879444918600
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 vfree+0x20e/0x390 mm/vmalloc.c:3440
 delayed_vfree_work+0x52/0x80 mm/vmalloc.c:3359
 process_one_work+0x7ac/0x1474 kernel/workqueue.c:3263
 process_scheduled_works kernel/workqueue.c:3346 [inline]
 worker_thread+0x984/0xe90 kernel/workqueue.c:3427
 kthread+0x65a/0x79c kernel/kthread.c:463
 ret_from_fork_kernel+0x38/0xa64 arch/riscv/kernel/process.c:228
 ret_from_fork_kernel_asm+0x16/0x1c arch/riscv/kernel/entry.S:147
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:aa7b3
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x3da pfn:0xaa7b3
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 00000000000003da 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480907000, free_ts 2879445108700
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 vfree+0x20e/0x390 mm/vmalloc.c:3440
 delayed_vfree_work+0x52/0x80 mm/vmalloc.c:3359
 process_one_work+0x7ac/0x1474 kernel/workqueue.c:3263
 process_scheduled_works kernel/workqueue.c:3346 [inline]
 worker_thread+0x984/0xe90 kernel/workqueue.c:3427
 kthread+0x65a/0x79c kernel/kthread.c:463
 ret_from_fork_kernel+0x38/0xa64 arch/riscv/kernel/process.c:228
 ret_from_fork_kernel_asm+0x16/0x1c arch/riscv/kernel/entry.S:147
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:a8c9d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x3c5 pfn:0xa8c9d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 00000000000003c5 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480739700, free_ts 2879445264500
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 vfree+0x20e/0x390 mm/vmalloc.c:3440
 delayed_vfree_work+0x52/0x80 mm/vmalloc.c:3359
 process_one_work+0x7ac/0x1474 kernel/workqueue.c:3263
 process_scheduled_works kernel/workqueue.c:3346 [inline]
 worker_thread+0x984/0xe90 kernel/workqueue.c:3427
 kthread+0x65a/0x79c kernel/kthread.c:463
 ret_from_fork_kernel+0x38/0xa64 arch/riscv/kernel/process.c:228
 ret_from_fork_kernel_asm+0x16/0x1c arch/riscv/kernel/entry.S:147
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:c9b82
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xc9b82
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480564400, free_ts 2879445412200
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 vfree+0x20e/0x390 mm/vmalloc.c:3440
 delayed_vfree_work+0x52/0x80 mm/vmalloc.c:3359
 process_one_work+0x7ac/0x1474 kernel/workqueue.c:3263
 process_scheduled_works kernel/workqueue.c:3346 [inline]
 worker_thread+0x984/0xe90 kernel/workqueue.c:3427
 kthread+0x65a/0x79c kernel/kthread.c:463
 ret_from_fork_kernel+0x38/0xa64 arch/riscv/kernel/process.c:228
 ret_from_fork_kernel_asm+0x16/0x1c arch/riscv/kernel/entry.S:147
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:cc61d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xcc61d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480405200, free_ts 2880116889000
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 ___free_pages_bulk mm/kasan/shadow.c:333 [inline]
 __kasan_populate_vmalloc mm/kasan/shadow.c:393 [inline]
 kasan_populate_vmalloc+0x1d2/0x244 mm/kasan/shadow.c:435
 alloc_vmap_area+0xbb6/0x1134 mm/vmalloc.c:2098
 __get_vm_area_node+0x1fe/0x3e4 mm/vmalloc.c:3193
 __vmalloc_node_range_noprof+0x344/0xdf0 mm/vmalloc.c:3857
 __vmalloc_node_noprof mm/vmalloc.c:3960 [inline]
 vzalloc_noprof+0xc2/0x100 mm/vmalloc.c:4034
 alloc_counters+0x78/0x5c8 net/ipv4/netfilter/ip_tables.c:799
 copy_entries_to_user net/ipv4/netfilter/ip_tables.c:821 [inline]
 get_entries net/ipv4/netfilter/ip_tables.c:1022 [inline]
 do_ipt_get_ctl+0x9a8/0xee4 net/ipv4/netfilter/ip_tables.c:1668
 nf_getsockopt+0x24c/0x26c net/netfilter/nf_sockopt.c:116
 ip_getsockopt+0x2d4/0x7a0 net/ipv4/ip_sockglue.c:1777
 tcp_getsockopt+0xb0/0xc8 net/ipv4/tcp.c:4810
 sock_common_getsockopt+0x92/0xa8 net/core/sock.c:3885
 do_sock_getsockopt+0x260/0x408 net/socket.c:2421
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:b289c
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb289c
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480240400, free_ts 2880247020000
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 8475 tgid 8473 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 pagetable_free include/linux/mm.h:3004 [inline]
 pagetable_dtor_free include/linux/mm.h:3107 [inline]
 __pgd_free include/asm-generic/pgalloc.h:289 [inline]
 pgd_free include/asm-generic/pgalloc.h:295 [inline]
 mm_free_pgd+0x2ac/0x370 kernel/fork.c:541
 __mmdrop+0x98/0x50c kernel/fork.c:683
 mmdrop include/linux/sched/mm.h:55 [inline]
 __mmput+0x3c6/0x400 kernel/fork.c:1145
 mmput+0x66/0x80 kernel/fork.c:1156
 exit_mm+0x15e/0x204 kernel/exit.c:582
 do_exit+0x520/0x1b78 kernel/exit.c:954
 do_group_exit+0x188/0x20c kernel/exit.c:1107
 get_signal+0x102c/0x10c0 kernel/signal.c:3034
 arch_do_signal_or_restart+0x2c0/0x19d8 arch/riscv/kernel/signal.c:534
 exit_to_user_mode_loop+0x7c/0x10c kernel/entry/common.c:40
 exit_to_user_mode_prepare include/linux/irq-entry-common.h:225 [inline]
 syscall_exit_to_user_mode_work include/linux/entry-common.h:175 [inline]
 syscall_exit_to_user_mode include/linux/entry-common.h:210 [inline]
 do_trap_ecall_u+0x2bc/0x4f4 arch/riscv/kernel/traps.c:357
 handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:b45ad
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb45ad
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480038700, free_ts 2880287929000
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 ___free_pages_bulk mm/kasan/shadow.c:333 [inline]
 __kasan_populate_vmalloc mm/kasan/shadow.c:393 [inline]
 kasan_populate_vmalloc+0x1d2/0x244 mm/kasan/shadow.c:435
 alloc_vmap_area+0xbb6/0x1134 mm/vmalloc.c:2098
 __get_vm_area_node+0x1fe/0x3e4 mm/vmalloc.c:3193
 __vmalloc_node_range_noprof+0x344/0xdf0 mm/vmalloc.c:3857
 __vmalloc_node_noprof mm/vmalloc.c:3960 [inline]
 vzalloc_noprof+0xc2/0x100 mm/vmalloc.c:4034
 xt_counters_alloc+0x60/0x70 net/netfilter/x_tables.c:1381
 __do_replace+0xa4/0x824 net/ipv4/netfilter/ip_tables.c:1046
 do_replace net/ipv4/netfilter/ip_tables.c:1141 [inline]
 do_ipt_set_ctl+0xc0a/0xec0 net/ipv4/netfilter/ip_tables.c:1635
 nf_setsockopt+0x256/0x278 net/netfilter/nf_sockopt.c:101
 ip_setsockopt+0x120/0x130 net/ipv4/ip_sockglue.c:1424
 tcp_setsockopt+0xb2/0xcc net/ipv4/tcp.c:4142
 sock_common_setsockopt+0x98/0xb0 net/core/sock.c:3912
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 ___free_pages_bulk mm/kasan/shadow.c:333 [inline]
 __kasan_populate_vmalloc mm/kasan/shadow.c:393 [inline]
 kasan_populate_vmalloc+0x1d2/0x244 mm/kasan/shadow.c:435
 alloc_vmap_area+0xbb6/0x1134 mm/vmalloc.c:2098
 __get_vm_area_node+0x1fe/0x3e4 mm/vmalloc.c:3193
 __vmalloc_node_range_noprof+0x344/0xdf0 mm/vmalloc.c:3857
 __vmalloc_node_noprof mm/vmalloc.c:3960 [inline]
 vzalloc_noprof+0xc2/0x100 mm/vmalloc.c:4034
 xt_counters_alloc+0x60/0x70 net/netfilter/x_tables.c:1381
 __do_replace+0xa4/0x824 net/ipv4/netfilter/ip_tables.c:1046
 do_replace net/ipv6/netfilter/ip6_tables.c:1158 [inline]
 do_ip6t_set_ctl+0xc0a/0xec0 net/ipv6/netfilter/ip6_tables.c:1644
 nf_setsockopt+0x256/0x278 net/netfilter/nf_sockopt.c:101
 ipv6_setsockopt+0x134/0x160 net/ipv6/ipv6_sockglue.c:978
 tcp_setsockopt+0xb2/0xcc net/ipv4/tcp.c:4142
 sock_common_setsockopt+0x98/0xb0 net/core/sock.c:3912
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 vfree+0x20e/0x390 mm/vmalloc.c:3440
 __do_replace+0x722/0x824 net/ipv4/netfilter/ip_tables.c:1090
 do_replace net/ipv6/netfilter/ip6_tables.c:1158 [inline]
 do_ip6t_set_ctl+0xc0a/0xec0 net/ipv6/netfilter/ip6_tables.c:1644
 nf_setsockopt+0x256/0x278 net/netfilter/nf_sockopt.c:101
 ipv6_setsockopt+0x134/0x160 net/ipv6/ipv6_sockglue.c:978
 tcp_setsockopt+0xb2/0xcc net/ipv4/tcp.c:4142
 sock_common_setsockopt+0x98/0xb0 net/core/sock.c:3912
 do_sock_setsockopt+0x20c/0x384 net/socket.c:2360
 __sys_setsockopt net/socket.c:2385 [inline]
 __do_sys_setsockopt net/socket.c:2391 [inline]
 __se_sys_setsockopt net/socket.c:2388 [inline]
 __riscv_sys_setsockopt+0x16c/0x1e0 net/socket.c:2388
 syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
 do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
 handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c mm/page_owner.c:332
 set_page_owner include/linux/page_owner.h:32 [inline]
 post_alloc_hook+0x2e2/0x320 mm/page_alloc.c:1850
 prep_new_page mm/page_alloc.c:1858 [inline]
 get_page_from_freelist+0x1a24/0x1ac4 mm/page_alloc.c:3884
 __alloc_frozen_pages_noprof+0x170/0x2fc mm/page_alloc.c:5183
 __alloc_pages_noprof+0x12/0x110 mm/page_alloc.c:5217
 alloc_pages_bulk_noprof+0x4d6/0x6b0 mm/page_alloc.c:5137
 alloc_pages_bulk_node_noprof include/linux/gfp.h:254 [inline]
 __page_pool_alloc_netmems_slow+0x1ae/0x708 net/core/page_pool.c:612
 page_pool_alloc_netmems+0xcc/0x194 net/core/page_pool.c:663
 page_pool_alloc_netmem include/net/page_pool/helpers.h:128 [inline]
 page_pool_alloc include/net/page_pool/helpers.h:167 [inline]
 page_pool_dev_alloc include/net/page_pool/helpers.h:188 [inline]
 skb_pp_cow_data+0xa40/0x11cc net/core/skbuff.c:952
 skb_cow_data_for_xdp+0x6e/0xa0 net/core/skbuff.c:986
 netif_skb_check_for_xdp net/core/dev.c:5429 [inline]
 netif_receive_generic_xdp net/core/dev.c:5470 [inline]
 do_xdp_generic+0x7c6/0x1188 net/core/dev.c:5538
 __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
 __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
 __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
 netif_receive_skb_internal net/core/dev.c:6278 [inline]
 netif_receive_skb+0x202/0x908 net/core/dev.c:6337
 tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
 tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc mm/page_owner.c:311
 reset_page_owner include/linux/page_owner.h:25 [inline]
 free_pages_prepare mm/page_alloc.c:1394 [inline]
 __free_frozen_pages+0xcd6/0xdd4 mm/page_alloc.c:2906
 ___free_pages+0xb0/0x1e4 mm/page_alloc.c:5264
 __free_pages+0xe/0x18 mm/page_alloc.c:5302
 vfree+0x20e/0x390 mm/vmalloc.c:3440
 delayed_vfree_work+0x52/0x80 mm/vmalloc.c:3359
 process_one_work+0x7ac/0x1474 kernel/workqueue.c:3263
 process_scheduled_works kernel/workqueue.c:3346 [inline]
 worker_thread+0x984/0xe90 kernel/workqueue.c:3427
 kthread+0x65a/0x79c kernel/kthread.c:463
 ret_from_fork_kernel+0x38/0xa64 arch/riscv/kernel/process.c:228
 ret_from_fork_kernel_asm+0x16/0x1c arch/riscv/kernel/entry.S:147
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c arch/riscv/kernel/stacktrace.c:149
[<ffffffff8005eae0>] show_stack+0x30/0x3c arch/riscv/kernel/stacktrace.c:155
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30 lib/dump_stack.c:94
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c lib/dump_stack.c:120
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24 lib/dump_stack.c:129
[<ffffffff809cc34c>] bad_page+0x1f0/0x244 mm/page_alloc.c:649
[<ffffffff809bc88c>] free_page_is_bad mm/page_alloc.c:1082 [inline]
[<ffffffff809bc88c>] free_pages_prepare mm/page_alloc.c:1386 [inline]
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4 mm/page_alloc.c:2906
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18 mm/page_alloc.c:2944
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8 mm/page_frag_cache.c:169
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8 net/core/xdp.c:448
[<ffffffff84cb8a22>] bpf_xdp_shrink_data net/core/filter.c:4191 [inline]
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c net/core/filter.c:4215
[<ffffffff84c7df4e>] ____bpf_xdp_adjust_tail net/core/filter.c:4237 [inline]
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4 net/core/filter.c:4230
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30 net/core/filter.c:11796
[<ffffffff84be80c4>] __bpf_prog_run include/linux/filter.h:721 [inline]
[<ffffffff84be80c4>] bpf_prog_run_xdp include/net/xdp.h:696 [inline]
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8 net/core/dev.c:5360
[<ffffffff84be9f7e>] netif_receive_generic_xdp net/core/dev.c:5476 [inline]
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188 net/core/dev.c:5538
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48 net/core/dev.c:5889
[<ffffffff84c111b8>] __netif_receive_skb_one_core net/core/dev.c:6077 [inline]
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250 net/core/dev.c:6192
[<ffffffff84bed882>] netif_receive_skb_internal net/core/dev.c:6278 [inline]
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908 net/core/dev.c:6337
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c drivers/net/tun.c:-1
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814 drivers/net/tun.c:1953
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc drivers/net/tun.c:1999
[<ffffffff80b5ed3a>] new_sync_write fs/read_write.c:593 [inline]
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68 fs/read_write.c:686
[<ffffffff80b5f63e>] ksys_write+0x126/0x230 fs/read_write.c:738
[<ffffffff80b5f7bc>] __do_sys_write fs/read_write.c:749 [inline]
[<ffffffff80b5f7bc>] __se_sys_write fs/read_write.c:746 [inline]
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84 fs/read_write.c:746
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4 arch/riscv/include/asm/syscall.h:112
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4 arch/riscv/kernel/traps.c:343
[<ffffffff85cbd878>] handle_exception+0x160/0x16e arch/riscv/kernel/entry.S:147

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Not tainted 6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
Disabling lock debugging due to kernel taint
BUG: Bad page state in process syz.4.602  pfn:9df7b
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff6000001df7b000 pfn:0x9df7b
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff6000001df7b000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881481095400, free_ts 2879444918600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:aa7b3
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x3da pfn:0xaa7b3
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 00000000000003da 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480907000, free_ts 2879445108700
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:a8c9d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x3c5 pfn:0xa8c9d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 00000000000003c5 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480739700, free_ts 2879445264500
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:c9b82
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xc9b82
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480564400, free_ts 2879445412200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:cc61d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xcc61d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480405200, free_ts 2880116889000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 alloc_counters+0x78/0x5c8
 do_ipt_get_ctl+0x9a8/0xee4
 nf_getsockopt+0x24c/0x26c
 ip_getsockopt+0x2d4/0x7a0
 tcp_getsockopt+0xb0/0xc8
 sock_common_getsockopt+0x92/0xa8
 do_sock_getsockopt+0x260/0x408
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b289c
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb289c
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480240400, free_ts 2880247020000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 8475 tgid 8473 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 mm_free_pgd+0x2ac/0x370
 __mmdrop+0x98/0x50c
 __mmput+0x3c6/0x400
 mmput+0x66/0x80
 exit_mm+0x15e/0x204
 do_exit+0x520/0x1b78
 do_group_exit+0x188/0x20c
 get_signal+0x102c/0x10c0
 arch_do_signal_or_restart+0x2c0/0x19d8
 exit_to_user_mode_loop+0x7c/0x10c
 do_trap_ecall_u+0x2bc/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b45ad
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb45ad
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480038700, free_ts 2880287929000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ipt_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ip_setsockopt+0x120/0x130
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:aa7b3
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x3da pfn:0xaa7b3
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 00000000000003da 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480907000, free_ts 2879445108700
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:a8c9d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x3c5 pfn:0xa8c9d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 00000000000003c5 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480739700, free_ts 2879445264500
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:c9b82
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xc9b82
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480564400, free_ts 2879445412200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:cc61d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xcc61d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480405200, free_ts 2880116889000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 alloc_counters+0x78/0x5c8
 do_ipt_get_ctl+0x9a8/0xee4
 nf_getsockopt+0x24c/0x26c
 ip_getsockopt+0x2d4/0x7a0
 tcp_getsockopt+0xb0/0xc8
 sock_common_getsockopt+0x92/0xa8
 do_sock_getsockopt+0x260/0x408
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b289c
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb289c
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480240400, free_ts 2880247020000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 8475 tgid 8473 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 mm_free_pgd+0x2ac/0x370
 __mmdrop+0x98/0x50c
 __mmput+0x3c6/0x400
 mmput+0x66/0x80
 exit_mm+0x15e/0x204
 do_exit+0x520/0x1b78
 do_group_exit+0x188/0x20c
 get_signal+0x102c/0x10c0
 arch_do_signal_or_restart+0x2c0/0x19d8
 exit_to_user_mode_loop+0x7c/0x10c
 do_trap_ecall_u+0x2bc/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b45ad
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb45ad
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480038700, free_ts 2880287929000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ipt_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ip_setsockopt+0x120/0x130
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:a8c9d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x3c5 pfn:0xa8c9d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 00000000000003c5 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480739700, free_ts 2879445264500
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:c9b82
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xc9b82
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480564400, free_ts 2879445412200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:cc61d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xcc61d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480405200, free_ts 2880116889000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 alloc_counters+0x78/0x5c8
 do_ipt_get_ctl+0x9a8/0xee4
 nf_getsockopt+0x24c/0x26c
 ip_getsockopt+0x2d4/0x7a0
 tcp_getsockopt+0xb0/0xc8
 sock_common_getsockopt+0x92/0xa8
 do_sock_getsockopt+0x260/0x408
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b289c
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb289c
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480240400, free_ts 2880247020000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 8475 tgid 8473 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 mm_free_pgd+0x2ac/0x370
 __mmdrop+0x98/0x50c
 __mmput+0x3c6/0x400
 mmput+0x66/0x80
 exit_mm+0x15e/0x204
 do_exit+0x520/0x1b78
 do_group_exit+0x188/0x20c
 get_signal+0x102c/0x10c0
 arch_do_signal_or_restart+0x2c0/0x19d8
 exit_to_user_mode_loop+0x7c/0x10c
 do_trap_ecall_u+0x2bc/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b45ad
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb45ad
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480038700, free_ts 2880287929000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ipt_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ip_setsockopt+0x120/0x130
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:c9b82
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xc9b82
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480564400, free_ts 2879445412200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:cc61d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xcc61d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480405200, free_ts 2880116889000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 alloc_counters+0x78/0x5c8
 do_ipt_get_ctl+0x9a8/0xee4
 nf_getsockopt+0x24c/0x26c
 ip_getsockopt+0x2d4/0x7a0
 tcp_getsockopt+0xb0/0xc8
 sock_common_getsockopt+0x92/0xa8
 do_sock_getsockopt+0x260/0x408
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b289c
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb289c
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480240400, free_ts 2880247020000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 8475 tgid 8473 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 mm_free_pgd+0x2ac/0x370
 __mmdrop+0x98/0x50c
 __mmput+0x3c6/0x400
 mmput+0x66/0x80
 exit_mm+0x15e/0x204
 do_exit+0x520/0x1b78
 do_group_exit+0x188/0x20c
 get_signal+0x102c/0x10c0
 arch_do_signal_or_restart+0x2c0/0x19d8
 exit_to_user_mode_loop+0x7c/0x10c
 do_trap_ecall_u+0x2bc/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b45ad
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb45ad
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480038700, free_ts 2880287929000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ipt_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ip_setsockopt+0x120/0x130
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 55 tgid 55 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:cc61d
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xcc61d
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480405200, free_ts 2880116889000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 alloc_counters+0x78/0x5c8
 do_ipt_get_ctl+0x9a8/0xee4
 nf_getsockopt+0x24c/0x26c
 ip_getsockopt+0x2d4/0x7a0
 tcp_getsockopt+0xb0/0xc8
 sock_common_getsockopt+0x92/0xa8
 do_sock_getsockopt+0x260/0x408
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b289c
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb289c
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480240400, free_ts 2880247020000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 8475 tgid 8473 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 mm_free_pgd+0x2ac/0x370
 __mmdrop+0x98/0x50c
 __mmput+0x3c6/0x400
 mmput+0x66/0x80
 exit_mm+0x15e/0x204
 do_exit+0x520/0x1b78
 do_group_exit+0x188/0x20c
 get_signal+0x102c/0x10c0
 arch_do_signal_or_restart+0x2c0/0x19d8
 exit_to_user_mode_loop+0x7c/0x10c
 do_trap_ecall_u+0x2bc/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b45ad
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb45ad
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480038700, free_ts 2880287929000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ipt_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ip_setsockopt+0x120/0x130
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 alloc_counters+0x78/0x5c8
 do_ipt_get_ctl+0x9a8/0xee4
 nf_getsockopt+0x24c/0x26c
 ip_getsockopt+0x2d4/0x7a0
 tcp_getsockopt+0xb0/0xc8
 sock_common_getsockopt+0x92/0xa8
 do_sock_getsockopt+0x260/0x408
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b289c
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb289c
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480240400, free_ts 2880247020000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 8475 tgid 8473 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 mm_free_pgd+0x2ac/0x370
 __mmdrop+0x98/0x50c
 __mmput+0x3c6/0x400
 mmput+0x66/0x80
 exit_mm+0x15e/0x204
 do_exit+0x520/0x1b78
 do_group_exit+0x188/0x20c
 get_signal+0x102c/0x10c0
 arch_do_signal_or_restart+0x2c0/0x19d8
 exit_to_user_mode_loop+0x7c/0x10c
 do_trap_ecall_u+0x2bc/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b45ad
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb45ad
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480038700, free_ts 2880287929000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ipt_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ip_setsockopt+0x120/0x130
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

page last free pid 8475 tgid 8473 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 mm_free_pgd+0x2ac/0x370
 __mmdrop+0x98/0x50c
 __mmput+0x3c6/0x400
 mmput+0x66/0x80
 exit_mm+0x15e/0x204
 do_exit+0x520/0x1b78
 do_group_exit+0x188/0x20c
 get_signal+0x102c/0x10c0
 arch_do_signal_or_restart+0x2c0/0x19d8
 exit_to_user_mode_loop+0x7c/0x10c
 do_trap_ecall_u+0x2bc/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b45ad
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb45ad
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881480038700, free_ts 2880287929000
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ipt_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ip_setsockopt+0x120/0x130
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ipt_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ip_setsockopt+0x120/0x130
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6d13
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xb6d13
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479873300, free_ts 2880474894200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 kasan_populate_vmalloc+0x1d2/0x244
 alloc_vmap_area+0xbb6/0x1134
 __get_vm_area_node+0x1fe/0x3e4
 __vmalloc_node_range_noprof+0x344/0xdf0
 vzalloc_noprof+0xc2/0x100
 xt_counters_alloc+0x60/0x70
 __do_replace+0xa4/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:9dfd6
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9dfd6
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: 0000000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479683000, free_ts 2880477352200
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

page last free pid 6397 tgid 6397 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 __do_replace+0x722/0x824
 do_ip6t_set_ctl+0xc0a/0xec0
 nf_setsockopt+0x256/0x278
 ipv6_setsockopt+0x134/0x160
 tcp_setsockopt+0xb2/0xcc
 sock_common_setsockopt+0x98/0xb0
 do_sock_setsockopt+0x20c/0x384
 __riscv_sys_setsockopt+0x16c/0x1e0
 syscall_handler+0x92/0xc4
 do_trap_ecall_u+0x9c/0x4f4
 handle_exception+0x160/0x16e
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e
BUG: Bad page state in process syz.4.602  pfn:b6e7a
page: refcount:0 mapcount:0 mapping:0000000000000000 index:0xff60000000000000 pfn:0xb6e7a
flags: 0xffe000000000000(node=0|zone=0|lastcpupid=0x7ff)
raw: 0ffe000000000000 dead000000000040 ff600000105ff000 0000000000000000
raw: ff60000000000000 0000000000000001 00000000ffffffff 0000000000000000
page dumped because: page_pool leak
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2820(GFP_ATOMIC|__GFP_NOWARN), pid 8479, tgid 8478 (syz.4.602), ts 2881479452500, free_ts 2880521959600
 __set_page_owner+0x98/0x41c
 post_alloc_hook+0x2e2/0x320
 get_page_from_freelist+0x1a24/0x1ac4
 __alloc_frozen_pages_noprof+0x170/0x2fc
 __alloc_pages_noprof+0x12/0x110
 alloc_pages_bulk_noprof+0x4d6/0x6b0
 __page_pool_alloc_netmems_slow+0x1ae/0x708
 page_pool_alloc_netmems+0xcc/0x194
 skb_pp_cow_data+0xa40/0x11cc
 skb_cow_data_for_xdp+0x6e/0xa0
 do_xdp_generic+0x7c6/0x1188
 __netif_receive_skb_core+0x16e2/0x3a48
 __netif_receive_skb+0x70/0x250
 netif_receive_skb+0x202/0x908
 tun_rx_batched+0x4d8/0x63c
 tun_get_user+0x264a/0x3814
page last free pid 6370 tgid 6370 stack trace:
 __reset_page_owner+0x68/0x1dc
 __free_frozen_pages+0xcd6/0xdd4
 ___free_pages+0xb0/0x1e4
 __free_pages+0xe/0x18
 vfree+0x20e/0x390
 delayed_vfree_work+0x52/0x80
 process_one_work+0x7ac/0x1474
 worker_thread+0x984/0xe90
 kthread+0x65a/0x79c
 ret_from_fork_kernel+0x38/0xa64
 ret_from_fork_kernel_asm+0x16/0x1c
Modules linked in:
CPU: 1 UID: 0 PID: 8479 Comm: syz.4.602 Tainted: G    B               6.18.0-rc5-g7e40c6791cc8 #1 PREEMPT 
Tainted: [B]=BAD_PAGE
Hardware name: riscv-virtio,qemu (DT)
Call Trace:
[<ffffffff800e2c76>] dump_backtrace+0x2e/0x3c
[<ffffffff8005eae0>] show_stack+0x30/0x3c
[<ffffffff800ce6ac>] __dump_stack+0x24/0x30
[<ffffffff800ce620>] dump_stack_lvl+0xf4/0x15c
[<ffffffff800ce6d4>] dump_stack+0x1c/0x24
[<ffffffff809cc34c>] bad_page+0x1f0/0x244
[<ffffffff809bc88c>] __free_frozen_pages+0xdac/0xdd4
[<ffffffff809bbad6>] free_frozen_pages+0xe/0x18
[<ffffffff809d2bb2>] page_frag_free+0x206/0x2f8
[<ffffffff84ccec0e>] __xdp_return+0x49a/0x8d8
[<ffffffff84cb8a22>] bpf_xdp_frags_shrink_tail+0x412/0x67c
[<ffffffff84c7df4e>] bpf_xdp_adjust_tail+0x196/0x1c4
[<ffffffff780000c4>] bpf_prog_5d7dc57dfd7f985a+0x28/0x36
[<ffffffff84cad802>] bpf_dispatcher_xdp_func+0x22/0x30
[<ffffffff84be80c4>] bpf_prog_run_generic_xdp+0x584/0x13e8
[<ffffffff84be9f7e>] do_xdp_generic+0x9ee/0x1188
[<ffffffff84c0dea6>] __netif_receive_skb_core+0x16e2/0x3a48
[<ffffffff84c111b8>] __netif_receive_skb+0x70/0x250
[<ffffffff84bed882>] netif_receive_skb+0x202/0x908
[<ffffffff82fd1de0>] tun_rx_batched+0x4d8/0x63c
[<ffffffff82fcff6e>] tun_get_user+0x264a/0x3814
[<ffffffff82fca090>] tun_chr_write_iter+0xfc/0x1cc
[<ffffffff80b5ed3a>] vfs_write+0x53e/0xa68
[<ffffffff80b5f63e>] ksys_write+0x126/0x230
[<ffffffff80b5f7bc>] __riscv_sys_write+0x74/0x84
[<ffffffff800e1dc6>] syscall_handler+0x92/0xc4
[<ffffffff85c9c364>] do_trap_ecall_u+0x9c/0x4f4
[<ffffffff85cbd878>] handle_exception+0x160/0x16e

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

SYZFAIL: failed to recv rpc
fd=3 want=4 recv=0 n=0 (errno 9: Bad file descriptor)

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

